var oereoApp = angular.module('oereoApp', [
  'restangular',
  'ngRoute',
  'ngAnimate',
  'ui.bootstrap',
  'directives',
  'filters'
]);

oereoApp.config(function ($routeProvider, RestangularProvider) {

  // ROUTING

  $routeProvider
    .when('/', {
      controller: 'ListController',
      templateUrl: '<%= asset_url("templates/resource_list.html") %>'
    })
    .when('/new', {
      controller: 'CreateController',
      templateUrl: '<%= asset_url("templates/resource_detail.html") %>'
    })
    .when('/edit/:resourceId', {
      controller:EditController,
      templateUrl: '<%= asset_url("templates/resource_detail.html") %>',
      resolve: {
        resource: function (Restangular, $route) {
          return Restangular.one('resources', $route.current.params.resourceId).get();
        }
      }
    })
    .otherwise({redirectTo: '/'});

  // CONFIGURE API

  RestangularProvider.setBaseUrl('/api');
  RestangularProvider.setDefaultHeaders({ 'X-AUTH-TOKEN': 'access_token' }); // FIXME: secure access token

  // Parse the response
  RestangularProvider.addResponseInterceptor(function(response, operation, what, url) {
    console.info('Received: ', response);

    if (operation === 'getList') {
      response = response[what];
      console.info('Extracted list: ', response);
    }
    else if (operation === 'get') {
      response = response[what.slice(0, -1)]; // Remove the S
      console.info('Extracted object: ', response);
    }

    return response;
  });

});
